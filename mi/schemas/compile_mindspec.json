{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "MI CompileMindSpec",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "version",
    "values_text",
    "values_summary",
    "decision_procedure",
    "defaults",
    "verification",
    "external_actions",
    "interrupt",
    "transparency",
    "violation_response"
  ],
  "properties": {
    "version": { "type": "string", "enum": ["v1"] },
    "values_text": { "type": "string" },
    "values_summary": { "type": "array", "items": { "type": "string" } },
    "decision_procedure": {
      "type": "object",
      "additionalProperties": false,
      "required": ["summary", "mermaid"],
      "properties": {
        "summary": { "type": "string" },
        "mermaid": { "type": "string" }
      }
    },
    "defaults": {
      "type": "object",
      "additionalProperties": false,
      "required": ["refactor_intent", "ask_when_uncertain"],
      "properties": {
        "refactor_intent": {
          "type": "string",
          "enum": ["behavior_preserving", "behavior_changing"]
        },
        "ask_when_uncertain": { "type": "boolean" }
      }
    },
    "verification": {
      "type": "object",
      "additionalProperties": false,
      "required": ["no_tests_policy"],
      "properties": {
        "no_tests_policy": {
          "type": "string",
          "enum": ["ask_once_per_project_then_remember"]
        }
      }
    },
    "external_actions": {
      "type": "object",
      "additionalProperties": false,
      "required": ["network_policy", "install_policy"],
      "properties": {
        "network_policy": { "type": "string", "enum": ["values_judged"] },
        "install_policy": { "type": "string", "enum": ["values_judged"] }
      }
    },
    "interrupt": {
      "type": "object",
      "additionalProperties": false,
      "required": ["mode", "signal_sequence", "escalation_ms"],
      "properties": {
        "mode": { "type": "string", "enum": ["off", "on_high_risk", "on_any_external"] },
        "signal_sequence": { "type": "array", "items": { "type": "string" } },
        "escalation_ms": { "type": "array", "items": { "type": "integer" } }
      }
    },
    "transparency": {
      "type": "object",
      "additionalProperties": false,
      "required": ["store_raw_transcript", "store_evidence_log", "ui_expandable_transcript"],
      "properties": {
        "store_raw_transcript": { "type": "boolean" },
        "store_evidence_log": { "type": "boolean" },
        "ui_expandable_transcript": { "type": "boolean" }
      }
    },
    "violation_response": {
      "type": "object",
      "additionalProperties": false,
      "required": ["auto_learn", "prompt_user_on_high_risk"],
      "properties": {
        "auto_learn": { "type": "boolean" },
        "prompt_user_on_high_risk": { "type": "boolean" }
      }
    }
  }
}

