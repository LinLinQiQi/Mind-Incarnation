{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "MI SuggestWorkflow",
  "type": "object",
  "additionalProperties": false,
  "required": ["should_suggest", "suggestion", "notes"],
  "properties": {
    "should_suggest": { "type": "boolean" },
    "suggestion": {
      "anyOf": [
        { "type": "null" },
        {
          "type": "object",
          "additionalProperties": false,
          "required": ["signature", "benefit", "confidence", "reason", "workflow"],
          "properties": {
            "signature": { "type": "string" },
            "benefit": { "type": "string", "enum": ["low", "medium", "high"] },
            "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
            "reason": { "type": "string" },
            "workflow": {
              "type": "object",
              "additionalProperties": false,
              "required": ["version", "id", "name", "enabled", "trigger", "mermaid", "steps", "source", "created_ts", "updated_ts"],
              "properties": {
                "version": { "type": "string", "enum": ["v1"] },
                "id": { "type": "string" },
                "name": { "type": "string" },
                "enabled": { "type": "boolean" },
                "trigger": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": ["mode", "pattern"],
                  "properties": {
                    "mode": { "type": "string", "enum": ["manual", "task_contains"] },
                    "pattern": { "type": "string" }
                  }
                },
                "mermaid": { "type": "string" },
                "steps": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "additionalProperties": false,
                    "required": ["id", "kind", "title", "hands_input", "check_input", "risk_category", "policy", "notes"],
                    "properties": {
                      "id": { "type": "string" },
                      "kind": { "type": "string", "enum": ["hands", "check", "gate"] },
                      "title": { "type": "string" },
                      "hands_input": { "type": "string" },
                      "check_input": { "type": "string" },
                      "risk_category": {
                        "type": "string",
                        "enum": ["network", "install", "push", "publish", "delete", "privilege", "privacy", "cost", "other"]
                      },
                      "policy": { "type": "string", "enum": ["values_judged", "allow", "deny", "ask"] },
                      "notes": { "type": "string" }
                    }
                  }
                },
                "source": {
                  "type": "object",
                  "additionalProperties": false,
                  "required": ["kind", "reason", "evidence_refs"],
                  "properties": {
                    "kind": { "type": "string", "enum": ["manual", "suggested"] },
                    "reason": { "type": "string" },
                    "evidence_refs": { "type": "array", "items": { "type": "string" } }
                  }
                },
                "created_ts": { "type": "string" },
                "updated_ts": { "type": "string" }
              }
            }
          }
        }
      ]
    },
    "notes": { "type": "string" }
  }
}

